<div class="container">
    <h1>GoKitt Graph Generation Test</h1>

    <div class="section">
        <h2>Status: <span [class.success]="status.includes('Ready') || status.includes('Complete')"
                [class.error]="status.includes('Error') || status.includes('Exception')">{{ status }}</span></h2>

        <div class="input-text">
            <strong>Input Text:</strong><br />
            "{{ sampleText }}"
        </div>

        <button (click)="runScan()" [disabled]="!status.includes('Ready') && !status.includes('Complete')">Run
            Scan</button>
        <button (click)="seedAndReady()">Re-Seed Entities</button>
    </div>

    <div class="section" *ngIf="scanResult">
        <h2>Scan Results</h2>

        <div *ngIf="scanResult.error" class="error">
            <h3>Error Returned</h3>
            <pre>{{ scanResult.error }}</pre>
        </div>

        <div *ngIf="!scanResult.error">
            <div class="kv-pair">
                <span>Timing:</span>
                <span>{{ scanResult.timing_us }} Âµs</span>
            </div>

            <h3>1. Scan Entities (ResolvedRefs)</h3>
            <div *ngIf="scanResult.scan?.ResolvedRefs?.length; else noRefs">
                <pre>{{ scanResult.scan.ResolvedRefs | json }}</pre>
            </div>
            <ng-template #noRefs>
                <div class="error">No ResolvedRefs found. (Is Dictionary working?)</div>
            </ng-template>

            <h3>2. Graph Analysis</h3>
            <div *ngIf="scanResult.graph">
                <p><strong>Nodes:</strong> {{ getKeys(scanResult.graph.Nodes).length }}</p>
                <p><strong>Edges:</strong> {{ scanResult.graph.Edges?.length ?? 0 }}</p>

                <h4>Edges (Relationships)</h4>
                <pre *ngIf="scanResult.graph.Edges?.length">{{ scanResult.graph.Edges | json }}</pre>
                <div *ngIf="!scanResult.graph.Edges?.length" class="error">No edges found in graph. (Projection failed?)
                </div>

                <h4>Graph Nodes</h4>
                <pre *ngIf="scanResult.graph.Nodes">{{ scanResult.graph.Nodes | json }}</pre>
            </div>
            <div *ngIf="!scanResult.graph" class="error">
                No 'graph' object returned.
            </div>

            <h3>3. CST Structure</h3>
            <pre>{{ scanResult.cst | json }}</pre>

            <h3>4. Full Raw Result</h3>
            <pre>{{ scanResult | json }}</pre>
        </div>
    </div>
</div>